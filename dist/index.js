module.exports=function(e){var t={};function s(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,s),r.l=!0,r.exports}return s.m=e,s.c=t,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(i,r,function(t){return e[t]}.bind(null,r));return i},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=0)}([function(e,t,s){"use strict";s.r(t);var i=class{constructor(e,t){this.id=e,this.name=t.name,this.lang=t.lang,this.voice=t,this.offline=t.localService}},r={ERROR:1,WARN:2},n={NOT_SUPPORT_RECOGNIRION:{type:r.ERROR,message:"This browser does not support Speech Recognition feature."},NOT_SUPPORT_FETCH:{type:r.ERROR,message:"This browser does not support Fetch feature."},NOT_SUPPORT_SYNTESIS:{type:r.ERROR,message:"This browser does not support Speech Syntesis feature."},NOT_SUPPORT_MEDIA:{type:r.ERROR,message:"This browser does not support Media Devices feature."},NOT_SUPPORT_PERMISSIONS:{type:r.ERROR,message:"This browser does not support Permissions feature."},INSTANCE_NOT_CREATED:{type:r.ERROR,message:"Instance was not created."},WRONG_VOICE:{type:r.WARN,message:"Wrong Voice ID."},TRANSLATION_UNAVAILABLE:{type:r.WARN,message:"Transtalion is unavailable."},TRANSLATION_ERROR:{type:r.WARN,message:"Transtalion service error."},DUE_TO_OFFLINE:{type:r.WARN,message:"This could be due to the fact that you're offline."},PERMISSION_DECLINED:{type:r.WARN,message:"User did not give permission."},RECOGNITION_ACTIVE:{type:r.WARN,message:"Recognition already active."},NOTHING_TO_TRANSLATE:{type:r.WARN,message:"Nothing to translate."}};const o="ru",a=!0,c=!0,h={audio:!0},u={name:"microphone"},l=["granted"],R="partly-recognized",g="recognized";class d extends EventTarget{constructor(){super(),this.mediaStream=null,this.isRecognitionActive=!1,this.permissionStatus=null,this.voices=[],this.ready=this.detectFeatures(),this.ready?(this.recognizer.continuous=a,this.recognizer.interimResults=c,this.recognizer.lang=o,this.recognizer.onresult=e=>{const t=e.results[e.resultIndex];t.isFinal?this.fullyRecognized(t[0].transcript):this.partlyRecognized(t[0].transcript)}):d.throw(n.INSTANCE_NOT_CREATED)}detectFeatures(){const e=self.speechRecognition||self.webkitSpeechRecognition,t=self.fetch,s=self.speechSynthesis,i=self.navigator.mediaDevices,r=self.navigator.permissions;return e?t?s&&s.getVoices?i?r?(this.fetch=t.bind(self),this.recognizer=new e,this.synthesizer=s,this.mediaDevices=i,this.permissions=r,!0):(d.throw(n.NOT_SUPPORT_PERMISSIONS),!1):(d.throw(n.NOT_SUPPORT_MEDIA),!1):(d.throw(n.NOT_SUPPORT_SYNTESIS),!1):(d.throw(n.NOT_SUPPORT_FETCH),!1):(d.throw(n.NOT_SUPPORT_RECOGNIRION),!1)}async init(){return!!this.ready&&Promise.all([this.getVoices(),this.getPermissionStatus()])}getVoices(){return new Promise(e=>{if(!this.ready)return!1;const t=setInterval(()=>{if(this.synthesizer.getVoices().length>0){const s=this.synthesizer.getVoices();this.voices=Object.entries(s).map(([e,t])=>new i(+e,t)),this.activeVoice=this.voices[0],clearInterval(t),e(this)}},10)})}requestPermission(e=h){return new Promise((t,s)=>{if(!this.ready)return!1;this.mediaDevices.getUserMedia(e).then(e=>{this.mediaStream=e,this.getPermissionStatus().then(()=>{t(e)})}).catch(e=>{this.getPermissionStatus().then(()=>{d.throw(n.PERMISSION_DECLINED),s(e)})})})}async getPermissionStatus(e=u){if(!this.ready)return!1;const t=await this.permissions.query(e);return this.permissionStatus=t.state,this.permissionStatus}static throw(e){const t=Object.entries(r).find(([,t])=>t===e.type)[0],s=`[SpeechTranslator ${t}]: ${e.message}`;console[t.toLowerCase()](s)}speak(e){if(!this.ready)return!1;const t=new SpeechSynthesisUtterance(e);t.voice=this.activeVoice.voice,this.synthesizer.speak(t)}setActiveVoice(e){if(!this.ready)return!1;let t;return t="number"==typeof e?this.voices.find(t=>t.id===e):this.voices.find(t=>t.name.toLowerCase().includes(e)||t.lang.toLowerCase().includes(e)),t?(this.activeVoice=t,this.activeVoice):(d.throw(n.WRONG_VOICE),navigator.onLine||d.throw(n.DUE_TO_OFFLINE),!1)}setRecognitionLang(e){return!!this.ready&&(this.recognizer.lang=e,!0)}async translate(e,t){if(!this.ready)return!1;if(!navigator.onLine)return d.throw(n.TRANSLATION_UNAVAILABLE),d.throw(n.DUE_TO_OFFLINE),flase;const s=new URL("https://translate.googleapis.com/translate_a/single"),i={client:"gtx",sl:"auto",tl:t,dt:"t",q:e};s.search=new URLSearchParams(i).toString();const r=await this.fetch(s);if(!r.ok)return d.throw(n.TRANSLATION_ERROR),!1;let o=await r.json();return o[0]?(o=o[0][0][0],o):(d.throw(n.NOTHING_TO_TRANSLATE),!1)}startRecognition(){return!!this.ready&&(l.includes(this.permissionStatus)?!this.isRecognitionActive&&(this.isRecognitionActive=!0,this.recognizer.start(),!0):(d.throw(n.PERMISSION_DECLINED),!1))}stopRecognition(){return!!this.ready&&(!!this.isRecognitionActive&&(this.isRecognitionActive=!1,this.recognizer.stop(),!0))}partlyRecognized(e){if(!this.ready)return!1;const t=new Event(R);return t.result=e,this.dispatchEvent(t),!0}fullyRecognized(e){if(!this.ready)return!1;const t=new Event(g);return t.result=e,this.dispatchEvent(t),!0}}var p=d;t.default=p}]);