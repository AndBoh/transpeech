module.exports=function(e){var t={};function s(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,s),r.l=!0,r.exports}return s.m=e,s.c=t,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(i,r,function(t){return e[t]}.bind(null,r));return i},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=0)}([function(e,t,s){"use strict";s.r(t);class i{constructor(e,t){this.id=e,this.name=t.name,this.lang=t.lang,this.voice=t,this.offline=t.localService}}const r="ru",n=!0,o={audio:!0},a={name:"microphone"},c=["granted"],h={ERROR:1,WARN:2},u={NOT_SUPPORT_RECOGNIRION:{type:h.ERROR,message:"This browser does not support Speech Recognition feature."},NOT_SUPPORT_FETCH:{type:h.ERROR,message:"This browser does not support Fetch feature."},NOT_SUPPORT_SYNTESIS:{type:h.ERROR,message:"This browser does not support Speech Syntesis feature."},NOT_SUPPORT_MEDIA:{type:h.ERROR,message:"This browser does not support Media Devices feature."},NOT_SUPPORT_PERMISSIONS:{type:h.ERROR,message:"This browser does not support Permissions feature."},INSTANCE_NOT_CREATED:{type:h.ERROR,message:"Instance was not created."},WRONG_VOICE:{type:h.WARN,message:"Wrong Voice ID."},TRANSLATION_UNAVAILABLE:{type:h.WARN,message:"Transtalion is unavailable."},TRANSLATION_ERROR:{type:h.WARN,message:"Transtalion service error."},DUE_TO_OFFLINE:{type:h.WARN,message:"This could be due to the fact that you're offline."},PERMISSION_DECLINED:{type:h.WARN,message:"User did not give permission."},RECOGNITION_ACTIVE:{type:h.WARN,message:"Recognition already active."}},l="partly-recognized",R="recognized";class d extends EventTarget{constructor(){super(),this.mediaStream=null,this.isRecognitionActive=!1,this.permissionStatus=null,this.voices=[],this.ready=this.detectFeatures(),this.ready?(this.recognizer.continuous=n,this.recognizer.lang=r,this.recognizer.onresult=e=>{const t=e.results[e.resultIndex];t.isFinal?this.fullyRecognized(t[0].transcript):this.partlyRecognized(t[0].transcript)}):this.throw(u.INSTANCE_NOT_CREATED)}detectFeatures(){const e=self.speechRecognition||self.webkitSpeechRecognition,t=self.fetch,s=self.speechSynthesis,i=self.navigator.mediaDevices,r=self.navigator.permissions;return e?t?s&&s.getVoices?i?r?(this.fetch=t.bind(window),this.recognizer=new e,this.synthesizer=s,this.mediaDevices=i,this.permissions=r,!0):(this.throw(u.NOT_SUPPORT_PERMISSIONS),!1):(this.throw(u.NOT_SUPPORT_MEDIA),!1):(this.throw(u.NOT_SUPPORT_SYNTESIS),!1):(this.throw(u.NOT_SUPPORT_FETCH),!1):(this.throw(u.NOT_SUPPORT_RECOGNIRION),!1)}async init(){return!!this.ready&&await Promise.all([this.getVoices(),this.getPermissionStatus()])}getVoices(){return new Promise((e,t)=>{if(!this.ready)return!1;let s=setInterval(()=>{if(this.synthesizer.getVoices().length>0){const t=this.synthesizer.getVoices();this.voices=Object.entries(t).map(([e,t])=>new i(+e,t)),this.activeVoice=this.voices[0],clearInterval(s),e(this)}},10)})}requestPermission(){return new Promise((e,t)=>{if(!this.ready)return!1;this.mediaDevices.getUserMedia(o).then(t=>{this.mediaStream=t,this.getPermissionStatus().then(()=>{e(t)})}).catch(e=>{this.getPermissionStatus().then(()=>{this.throw(u.PERMISSION_DECLINED),t(e)})})})}async getPermissionStatus(){if(!this.ready)return!1;const e=await this.permissions.query(a);return this.permissionStatus=e.state,this.permissionStatus}throw(e){const t=Object.entries(h).find(([t,s])=>s===e.type)[0],s=`[SpeechTranslator ${t}]: ${e.message}`;console[t.toLowerCase()](s)}speak(e){if(!this.ready)return!1;const t=new SpeechSynthesisUtterance(e);t.voice=this.activeVoice.voice,this.synthesizer.speak(t)}setActiveVoice(e){if(!this.ready)return!1;let t;return t="number"==typeof e?this.voices.find(t=>t.id===e):this.voices.find(t=>t.name.toLowerCase().includes(e)||t.lang.toLowerCase().includes(e)),t?(this.activeVoice=t,this.activeVoice):(this.throw(u.WRONG_VOICE),navigator.onLine||this.throw(u.DUE_TO_OFFLINE),!1)}setRecognitionLang(e){return!!this.ready&&(this.recognizer.lang=e,!0)}async translate(e,t){if(!this.ready)return!1;if(!navigator.onLine)return this.throw(u.TRANSLATION_UNAVAILABLE),this.throw(u.DUE_TO_OFFLINE),flase;const s=new URL("https://translate.googleapis.com/translate_a/single"),i={client:"gtx",sl:"auto",tl:t,dt:"t",q:e};s.search=new URLSearchParams(i).toString();const r=await this.fetch(s);if(!r.ok)return this.throw(u.TRANSLATION_ERROR),!1;let n=await r.json();return n=n[0][0][0],n}startRecognition(){return!!this.ready&&(c.includes(this.permissionStatus)?this.isRecognitionActive?(console.log(this),this.throw(u.RECOGNITION_ACTIVE),!1):(this.isRecognitionActive=!0,void this.recognizer.start()):(this.throw(u.PERMISSION_DECLINED),!1))}stopRecognition(){if(!this.ready)return!1;this.isRecognitionActive&&(this.isRecognitionActive=!1,this.recognizer.stop())}partlyRecognized(e){if(!this.ready)return!1;const t=new Event(l);t.result=e,this.dispatchEvent(t)}fullyRecognized(e){if(!this.ready)return!1;const t=new Event(R);t.result=e,this.dispatchEvent(t)}}t.default=d}]);