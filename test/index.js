!function(e){var t={};function n(i){if(t[i])return t[i].exports;var s=t[i]={i:i,l:!1,exports:{}};return e[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(i,s,function(t){return e[t]}.bind(null,s));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t){e.exports=function(e){var t={};function n(i){if(t[i])return t[i].exports;var s=t[i]={i:i,l:!1,exports:{}};return e[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(i,s,function(t){return e[t]}.bind(null,s));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t,n){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.PartlyRecognized="partly-recognized",e.FullyRecognized="recognized",e.VoicesReady="voices-ready",e.PermissionStatusReady="permissions-ready",e.Ready="ready"}(i||(i={})),t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Events=void 0;const i=n(2),s=n(0);t.Events=s.default,t.default=i.default},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(s,r){function o(e){try{u(i.next(e))}catch(e){r(e)}}function a(e){try{u(i.throw(e))}catch(e){r(e)}}function u(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}u((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const s=n(3),r=n(0),o=n(6),a=n(7),u=n(8);class c{constructor(e){this.eventTarget=new EventTarget,this.isRecognitionActive=!1,e=Object.assign(Object.assign({},u.defaultFeatures),e),this.silent=e.silent,this.ready=this.detectFeatures(e),this.ready?(e.recognition&&(this.recognizer.continuous=u.recognizerDefaults.continuous,this.recognizer.interimResults=u.recognizerDefaults.interimResults,this.recognizer.lang=u.recognizerDefaults.lang,this.recognizer.onresult=e=>{const t=e.results[e.resultIndex];t.isFinal?this.fullyRecognized(t[0].transcript):this.partlyRecognized(t[0].transcript),this.isRecognitionActive=!1}),Promise.all([new Promise((t,n)=>{e.synthesis?this.getVoices().then(e=>{this.voices=e,this.activeVoice=e[0],this.dispatch(r.default.VoicesReady,this.voices),t()}).catch(()=>{this.throw(s.default.UnableGetVoices),n()}):t()}),new Promise((t,n)=>{e.recognition?this.getPermissionStatus().then(e=>{this.permissionStatus=e.state,this.dispatch(r.default.PermissionStatusReady,this.permissionStatus)}).catch(()=>{this.throw(s.default.NotSupportPermissions),n()}):t()})]).then(()=>{this.dispatch(r.default.Ready)}).catch(()=>{this.throw(s.default.InstanceNotCreated)})):this.throw(s.default.InstanceNotCreated)}dispatch(e,t){this.eventTarget.dispatchEvent(new o.default(e,t))}on(e,t,n){this.eventTarget.addEventListener(e,t,n)}throw(e){this.silent||e.throw()}detectFeatures(e){var t,n;const i=c.availableFeatures;if(e.translation){if(!i.translation)return this.throw(s.default.NotSupportFetch),!1;this.fetch=self.fetch.bind(self)}if(e.synthesis){if(!i.synthesis)return this.throw(s.default.NotSupportSynthesis),!1;this.synthesizer=self.speechSynthesis}if(e.recognition){if(!i.recognition)return this.throw(s.default.NotSupportRecognition),!1;this.recognizer=new(self.webkitSpeechRecognition||self.speechRecognition),this.permissions=null===(t=self.navigator)||void 0===t?void 0:t.permissions,this.mediaDevices=null===(n=self.navigator)||void 0===n?void 0:n.mediaDevices}return!0}static get availableFeatures(){var e,t;return{recognition:!(!self.speechRecognition&&!self.webkitSpeechRecognition||!(null===(e=self.navigator)||void 0===e?void 0:e.mediaDevices)||!(null===(t=self.navigator)||void 0===t?void 0:t.permissions)),translation:!!self.fetch,synthesis:!!self.speechSynthesis}}getVoices(){return i(this,void 0,void 0,(function*(){let e,t=0;return new Promise((n,i)=>{e=setInterval(()=>{t>=100&&(clearInterval(e),i());const s=this.synthesizer.getVoices();(null==s?void 0:s.length)&&(clearInterval(e),n(s.map((e,t)=>new a.default(t,e)))),t+=1},10)})}))}getPermissionStatus(e=u.permissionsQueryDefault){return i(this,void 0,void 0,(function*(){return this.permissions.query(e)}))}requestPermission(e=u.mediaStreamConstraintsDefault){return i(this,void 0,void 0,(function*(){try{return this.mediaStream=yield this.mediaDevices.getUserMedia(e),this.permissionStatus=(yield this.getPermissionStatus()).state,this.mediaStream}catch(e){this.permissionStatus="denied",this.throw(s.default.PermissionDeclined)}}))}setActiveVoice(e){let t;return t="number"==typeof e?this.voices.find(t=>t.id===e):this.voices.find(t=>t.name.toLocaleLowerCase().includes(e.toLocaleLowerCase())||t.lang.toLocaleLowerCase().includes(e.toLocaleLowerCase())),t||(this.throw(s.default.WrongVoice),self.navigator.onLine||this.throw(s.default.DueToOffline)),this.activeVoice=t,t}get recognitionLang(){return this.recognizer.lang}set recognitionLang(e){this.recognizer.lang=e}speak(e){if(!e)return;const t=new SpeechSynthesisUtterance(e);t.voice=this.activeVoice.voice,this.synthesizer.speak(t)}translate(e,t){return i(this,void 0,void 0,(function*(){if(!e)return this.throw(s.default.NothingToTranslate),!1;if(!t)return this.throw(s.default.WrongLanguage),!1;if(!self.navigator.onLine)return this.throw(s.default.TranslationUnavilable),this.throw(s.default.DueToOffline),!1;const n=new URL(u.googleRequersDefaults.url);n.search=new URLSearchParams(Object.assign(Object.assign({},u.googleRequersDefaults.params),{tl:t,q:e})).toString();try{const e=yield this.fetch(n);if(!e.ok)return this.throw(s.default.TranslationError),!1;const t=yield e.json();return t[0]?t[0][0][0]:(this.throw(s.default.NothingToTranslate),!1)}catch(e){return this.throw(s.default.TranslationError),!1}}))}startRecognition(){if("granted"===this.permissionStatus)try{this.isRecognitionActive=!0,this.recognizer.start()}catch(e){this.throw(s.default.RecognitionActive)}else this.throw(s.default.PermissionDeclined)}stopRecognition(){this.isRecognitionActive=!1,this.recognizer.stop()}partlyRecognized(e){this.dispatch(r.default.PartlyRecognized,e)}fullyRecognized(e){this.dispatch(r.default.FullyRecognized,e),this.recognizer.continuous||(this.isRecognitionActive=!1)}}t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(4),s=n(5),r={NotSupportRecognition:new i.default(s.default.Error,"This browser does not support Speech Recognition feature."),NotSupportSynthesis:new i.default(s.default.Error,"This browser does not support Speech Synthesis feature."),NotSupportFetch:new i.default(s.default.Error,"This browser does not support Fetch feature."),NotSupportMedia:new i.default(s.default.Error,"This browser does not support Media Devices feature."),NotSupportPermissions:new i.default(s.default.Error,"This browser does not support Permissions feature."),InstanceNotCreated:new i.default(s.default.Error,"Instance was not created."),UnableGetVoices:new i.default(s.default.Error,"Unable to get voices."),WrongVoice:new i.default(s.default.Warn,"Wrong Voice ID."),TranslationUnavilable:new i.default(s.default.Warn,"Transtalion is unavailable."),TranslationError:new i.default(s.default.Warn,"Transtalion service error."),DueToOffline:new i.default(s.default.Warn,"This could be due to the fact that you're offline."),PermissionDeclined:new i.default(s.default.Warn,"User did not give permission."),RecognitionActive:new i.default(s.default.Warn,"Recognition already active."),NothingToTranslate:new i.default(s.default.Warn,"Nothing to translate."),WrongLanguage:new i.default(s.default.Warn,"Wrong translation language.")};t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e,t){this.type=e,this.message=t}throw(){const e=`[TranSpeech ${this.type}]: ${this.message}`;console[this.type](e)}}},function(e,t,n){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Error="error",e.Warn="warn"}(i||(i={})),t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class i extends Event{constructor(e,t){super(e),void 0!==typeof t&&(this.result=t)}}t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(e,t){this.id=e,this.name=t.name,this.lang=t.lang,this.offline=t.localService,this.voice=t}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.googleRequersDefaults=t.mediaStreamConstraintsDefault=t.permissionsQueryDefault=t.recognizerDefaults=t.defaultFeatures=void 0,t.defaultFeatures={recognition:!0,synthesis:!0,translation:!0,silent:!1},t.recognizerDefaults={continuous:!0,interimResults:!0,lang:"en"},t.permissionsQueryDefault={name:"microphone"},t.mediaStreamConstraintsDefault={audio:!0},t.googleRequersDefaults={url:"https://translate.googleapis.com/translate_a/single",params:{client:"gtx",sl:"auto",dt:"t"}}}])},function(e,t,n){"use strict";n.r(t);var i=n(0),s=n.n(i);let r;function o(e,t="div",n=document.body){const i=document.createElement(t);return i.innerText=e,n.appendChild(i),i}o("Available Features Test","h2");let a=s.a.availableFeatures,u=o("");u.classList.add("table-3"),["synthesis","translation","recognition"].forEach(e=>{o(e.toUpperCase(),"span",u),o(a.hasOwnProperty(e)?"OK":"FAIL","span",u),o(a[e]?"Active":"Inactive","span",u)});let c=new s.a;c.ready&&o("Instance created"),c.on(i.Events.PermissionStatusReady,e=>{o("Permission status ready event recieved. Status: "),o(e.result,"span").classList.add("permission-status")}),c.on(i.Events.VoicesReady,e=>{o("Voices ready event recieved. Voices count: "),o(e.result.length,"span"),o("Active voice name: "),r=o(c.activeVoice.name,"span");for(let t=0;t<3;t++){o(e.result[t].name,"option",d).setAttribute("value",e.result[t].id)}}),c.on(i.Events.FullyRecognized,e=>{o("Fully recognized: "+e.result)}),c.on(i.Events.PartlyRecognized,e=>{o("Partly recognized: "+e.result)}),c.recognitionLang="ru",o("Recognition lang:"),o(c.recognitionLang,"span"),o("Is recognition active:");let l=o(c.isRecognitionActive,"span");o("Actions","h2"),o("Request permisson","button").onclick=()=>{c.requestPermission().then(e=>{document.querySelector(".permission-status").innerText=c.permissionStatus,console.log(e)}).catch(()=>{document.querySelector(".permission-status").innerText=c.permissionStatus})},o("Set active voice:");let d=o("","select");d.onchange=e=>{c.setActiveVoice(+e.target.value),r.innerText=c.activeVoice.name},o("Speak","button").onclick=()=>{c.speak("Hello TranSpeech!")},o('Translate "Hello world" to Italian:');let f=o("","span");c.translate("Hello word","it").then(e=>{f.innerText=e}),o("Start recognition","button").onclick=()=>{c.startRecognition(),l.innerText=c.isRecognitionActive},o("Stop recognition","button").onclick=()=>{c.stopRecognition(),l.innerText=c.isRecognitionActive},o("Events","h2")}]);